import os
import re
from win32com.client import Dispatch
import pandas as pd

folder = os.getcwd()
list_file=[]
list_path=[]

for (dirpath, dirnames, filenames) in os.walk('.'):
    for f in filenames: 
        if os.path.splitext(f)[1][1:].strip() in ("xls","xlsx"):  #filter extension type
            list_file.append(f)
            list_path1=(folder+(str(os.path.join(dirpath,f)))[1:])
            list_path.append(list_path1)
            
            ##Extract excel to csv 
            excel_file = list_path1
            output_csv = list_path1+'.csv'
            df = pd.read_excel(excel_file, sheet_name=None)
            xlsx = pd.ExcelFile(excel_file)
            PC_sheets = []
            for sheet in xlsx.sheet_names:
                PC_sheets.append(xlsx.parse(sheet))
                PC = pd.concat(PC_sheets)
            PC.to_csv(output_csv, encoding='utf-8', index=False)  
            
            ##Extract to html file
            app = Dispatch("Excel.Application")
            workbook_file_name = list_path1            
            OutputName = list_path1+'.htm'
            workbook = app.Workbooks.Open(Filename=workbook_file_name)
            app.DisplayAlerts = False
            try:
                workbook.SaveAs(Filename=OutputName, FileFormat=44)  # 44 = html file format
            except Exception as ex:
                print(ex)
            finally:
                workbook.Close(SaveChanges=False, Filename=workbook_file_name)
